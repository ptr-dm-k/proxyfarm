# Load Balancing –≤ ProxyFarm

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞

ProxyFarm –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Linux kernel multipath routing —Å L4 hash policy –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ –º–µ–∂–¥—É –º–æ–¥–µ–º–∞–º–∏.

### Multipath Route

```bash
default
    nexthop via 10.224.132.1 dev wwan0 weight 1
    nexthop via 10.231.254.1 dev wwan1 weight 1
```

### L4 Hash Policy

```bash
net.ipv4.fib_multipath_hash_policy=1
```

Kernel –≤—ã—á–∏—Å–ª—è–µ—Ç hash –Ω–∞ –æ—Å–Ω–æ–≤–µ:
- Source IP
- Destination IP
- Source Port
- Destination Port

**–ö–ª—é—á–µ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** –û–¥–Ω–æ TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤—Å–µ–≥–¥–∞ –∏–¥–µ—Ç —á–µ—Ä–µ–∑ –æ–¥–∏–Ω nexthop (–º–æ–¥–µ–º).

## –ü–æ–≤–µ–¥–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏

### –ù–∞ Orange Pi (–Ω–∞–ø—Ä—è–º—É—é)

```bash
root@orangepi:~# curl ifconfig.me
91.151.136.213  # –ù–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ ‚Üí wwan0

root@orangepi:~# curl ifconfig.me
91.151.136.207  # –ù–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ ‚Üí wwan1

root@orangepi:~# curl ifconfig.me
91.151.136.213  # –ù–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ ‚Üí wwan0
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ~50/50 –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ –∫–∞–∂–¥—ã–π `curl` —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤–æ–µ TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.

### –ß–µ—Ä–µ–∑ Squid Proxy

```bash
petr@mac % curl -x http://138.2.138.243:3128 ifconfig.me
91.151.136.213  # Squid –æ—Ç–∫—Ä—ã–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ wwan0

petr@mac % curl -x http://138.2.138.243:3128 ifconfig.me
91.151.136.213  # Squid –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

petr@mac % curl -x http://138.2.138.243:3128 ifconfig.me
91.151.136.213  # Squid –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

# ...–ø–æ—Å–ª–µ timeout –∏–ª–∏ –Ω–æ–≤–æ–≥–æ —Ö–æ—Å—Ç–∞...

petr@mac % curl -x http://138.2.138.243:3128 ifconfig.me
91.151.136.207  # Squid –æ—Ç–∫—Ä—ã–ª –Ω–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ wwan1
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** IP –º–µ–Ω—è—é—Ç—Å—è —Ä–µ–∂–µ –∏–∑-–∑–∞ connection pooling.

## –ü–æ—á–µ–º—É —ç—Ç–æ —Ö–æ—Ä–æ—à–æ?

### 1. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
Connection pooling **–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ** —É—Å–∫–æ—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã:
- –ë–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –ë–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ SSL handshake
- –ú–µ–Ω—å—à–µ –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

### 2. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ø—Ä–æ–∫—Å–∏
- –ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Ü–µ–ª–µ–≤—ã–µ —Å–µ—Ä–≤–µ—Ä—ã
- –≠–∫–æ–Ω–æ–º–∏—è —Ç—Ä–∞—Ñ–∏–∫–∞

### 3. –°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
- –û–¥–Ω–æ TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ —Ä–∞–∑—Ä—ã–≤–∞–µ—Ç—Å—è –º–µ–∂–¥—É –º–æ–¥–µ–º–∞–º–∏
- –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å –ø–æ—Ç–µ—Ä–µ–π –ø–∞–∫–µ—Ç–æ–≤ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏

## –ö–∞–∫ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏

### –†–µ–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ (–≤–µ–±-—Å–∫—Ä–µ–π–ø–∏–Ω–≥, API –∑–∞–ø—Ä–æ—Å—ã)

```python
import requests

# –†–∞–∑–Ω—ã–µ –¥–æ–º–µ–Ω—ã ‚Üí —Ä–∞–∑–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è ‚Üí –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞
requests.get("https://api.example1.com", proxies=proxies)  # wwan0
requests.get("https://api.example2.com", proxies=proxies)  # wwan1
requests.get("https://api.example3.com", proxies=proxies)  # wwan0
```

### –ú–Ω–æ–≥–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

```python
from concurrent.futures import ThreadPoolExecutor

urls = ["https://api.example.com/item/{}".format(i) for i in range(100)]

with ThreadPoolExecutor(max_workers=10) as executor:
    # 10 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
    # –†–∞—Å–ø—Ä–µ–¥–µ–ª—è—Ç—Å—è –º–µ–∂–¥—É wwan0 –∏ wwan1
    results = executor.map(lambda url: requests.get(url, proxies=proxies), urls)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –•–æ—Ä–æ—à–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ ~50/50.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏

### ‚ùå –ü–ª–æ—Ö–æ–π —Å–ø–æ—Å–æ–± (–Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É)

```bash
# –ë—ã—Å—Ç—Ä—ã–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –æ–¥–Ω–æ–º—É —Ö–æ—Å—Ç—É
for i in {1..100}; do
  curl -x http://proxy:3128 http://ifconfig.me
done
# –†–µ–∑—É–ª—å—Ç–∞—Ç: 90% –Ω–∞ –æ–¥–Ω–æ–º IP, 10% –Ω–∞ –¥—Ä—É–≥–æ–º
# –ü–æ—á–µ–º—É: connection pooling
```

### ‚úÖ –•–æ—Ä–æ—à–∏–π —Å–ø–æ—Å–æ–± 1: –†–∞–∑–Ω—ã–µ —Ö–æ—Å—Ç—ã

```bash
curl -x http://proxy:3128 http://ifconfig.me      # wwan0
curl -x http://proxy:3128 http://api.ipify.org    # wwan1
curl -x http://proxy:3128 http://icanhazip.com    # wwan0
curl -x http://proxy:3128 http://ident.me         # wwan1
# –†–µ–∑—É–ª—å—Ç–∞—Ç: ~50/50 –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞
```

### ‚úÖ –•–æ—Ä–æ—à–∏–π —Å–ø–æ—Å–æ–± 2: –° –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏

```bash
for i in {1..20}; do
  curl -x http://proxy:3128 http://ifconfig.me
  sleep 2  # –î–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—é –∑–∞–∫—Ä—ã—Ç—å—Å—è
done
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –õ—É—á—à–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞
```

### ‚úÖ –•–æ—Ä–æ—à–∏–π —Å–ø–æ—Å–æ–± 3: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

```bash
for i in {1..20}; do
  curl -x http://proxy:3128 http://ifconfig.me &
done
wait
# –†–µ–∑—É–ª—å—Ç–∞—Ç: –•–æ—Ä–æ—à–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞
```

### ‚úÖ –•–æ—Ä–æ—à–∏–π —Å–ø–æ—Å–æ–± 4: –°–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
cd /Users/petr/repo/proxyfarm/scripts
./test_balancing.sh
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Squid –¥–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏

### –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–æ–ø—Ç–∏–º–∞–ª—å–Ω–∞—è)

```squid
# Connection pooling –≤–∫–ª—é—á–µ–Ω
client_persistent_connections on
server_persistent_connections on
pconn_timeout 1 minute

# –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ–º tcp_outgoing_address
# –ü–æ–∑–≤–æ–ª—è–µ–º kernel routing –¥–µ–ª–∞—Ç—å –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É
```

### ‚ùå –ß—Ç–æ –ù–ï –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å

```squid
# –ù–ï –î–ï–õ–ê–ô–¢–ï –¢–ê–ö:
tcp_outgoing_address 91.151.136.213  # –ó–∞—Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –Ω–∞ –æ–¥–Ω–æ–º IP
```

Squid –Ω–µ —É–º–µ–µ—Ç —Å–∞–º –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞—Ç—å –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ IP. Kernel routing –¥–µ–ª–∞–µ—Ç —ç—Ç–æ –ª—É—á—à–µ.

## –ú–µ—Ç—Ä–∏–∫–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏

### –ö–∞–∫ –∏–∑–º–µ—Ä—è—Ç—å

```bash
# –ù–∞ Orange Pi
cd /root/repo/proxyfarm/scripts
./test_balancing.sh
```

### –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

**–•–æ—Ä–æ—à–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞:**
- 40-60% –Ω–∞ –∫–∞–∂–¥—ã–π –º–æ–¥–µ–º –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ä–∞–∑–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤
- 30-70% –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –æ–¥–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞ (–∏–∑-–∑–∞ connection pooling)

**–ü–ª–æ—Ö–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞:**
- >90% –Ω–∞ –æ–¥–Ω–æ–º –º–æ–¥–µ–º–µ
- –û–¥–∏–Ω –º–æ–¥–µ–º –æ—Ç–∫–ª—é—á–µ–Ω –∏–ª–∏ –∏–º–µ–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

```bash
# Terminal 1: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–∞—Ñ–∏–∫–∞ wwan0
watch -n 1 'ifconfig wwan0 | grep "RX packets"'

# Terminal 2: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–∞—Ñ–∏–∫–∞ wwan1
watch -n 1 'ifconfig wwan1 | grep "RX packets"'

# Terminal 3: –î–µ–ª–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã
for i in {1..100}; do
  curl -x http://proxy:3128 http://example.com
  sleep 0.5
done
```

–í—ã –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å —Ä–æ—Å—Ç –ø–∞–∫–µ—Ç–æ–≤ –Ω–∞ –æ–±–æ–∏—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö.

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏

### –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞

–ú–æ–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å `pconn_timeout` –≤ Squid:

```squid
# /etc/squid/squid.conf
pconn_timeout 10 seconds  # –í–º–µ—Å—Ç–æ 1 minute
```

**–ö–æ–º–ø—Ä–æ–º–∏—Å—Å:**
- ‚úÖ –õ—É—á—à–µ –≤–∏–¥–∏–º–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞
- ‚ùå –ù–µ–º–Ω–æ–≥–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ –∑–∞–ø—Ä–æ—Å—ã (–±–æ–ª—å—à–µ handshakes)

### –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å (1 –º–∏–Ω—É—Ç–∞):

```squid
pconn_timeout 1 minute
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –≤—Å–µ —Ä–∞–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø—Ä–æ—Å—Ç–æ –º–µ–Ω–µ–µ –≤–∏–¥–∏–º–∞—è)

## FAQ

### Q: –ü–æ—á–µ–º—É 20 –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–¥—Ä—è–¥ –∏–¥—É—Ç —á–µ—Ä–µ–∑ –æ–¥–∏–Ω IP?

**A:** Squid –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (connection pooling). –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –∏ —Ö–æ—Ä–æ—à–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

### Q: –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

**A:**
1. –ó–∞–ø—Ä–æ—Å—ã –∫ —Ä–∞–∑–Ω—ã–º —Ö–æ—Å—Ç–∞–º
2. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–∞—Ñ–∏–∫–∞ –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö (ifconfig)
4. –õ–æ–≥–∏ Squid (`/var/log/squid/access.log`)

### Q: –ù—É–∂–Ω–æ –ª–∏ –æ—Ç–∫–ª—é—á–∞—Ç—å connection pooling?

**A:** –ù–µ—Ç! Connection pooling –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–µ–Ω –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ—Å—Ç–æ –º–µ–Ω–µ–µ –∑–∞–º–µ—Ç–Ω–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∞—Ö.

### Q: –û–¥–∏–Ω –º–æ–¥–µ–º –ø–æ–ª—É—á–∞–µ—Ç –±–æ–ª—å—à–µ —Ç—Ä–∞—Ñ–∏–∫–∞, —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞?

**A:** –ù–µ–±–æ–ª—å—à–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ (55/45) –Ω–æ—Ä–º–∞–ª—å–Ω–∞. –ë–æ–ª—å—à–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ (80/20) –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞:
- –û–¥–∏–Ω –º–æ–¥–µ–º –º–µ–¥–ª–µ–Ω–Ω–µ–µ (–ø–ª–æ—Ö–æ–π —Å–∏–≥–Ω–∞–ª)
- –ü—Ä–æ–±–ª–µ–º—ã —Å routing
- –û–¥–∏–Ω –º–æ–¥–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è

### Q: –ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å —Å—Ç—Ä–æ–≥—É—é –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É 50/50?

**A:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º multipath routing. L4 hash –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Ç–æ—á–Ω–æ–µ 50/50, —Ç–æ–ª—å–∫–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ. –î–ª—è —Ç–æ—á–Ω–æ–≥–æ 50/50 –Ω—É–∂–µ–Ω –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, HAProxy).

## –ü—Ä–∏–º–µ—Ä—ã –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏

### –í–µ–±-—Å–∫—Ä–µ–π–ø–∏–Ω–≥

```python
import requests
from concurrent.futures import ThreadPoolExecutor

proxies = {
    'http': 'http://138.2.138.243:3128',
    'https': 'http://138.2.138.243:3128'
}

urls = ["https://example.com/page/{}".format(i) for i in range(1000)]

def fetch(url):
    return requests.get(url, proxies=proxies, timeout=10)

# 20 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤
with ThreadPoolExecutor(max_workers=20) as executor:
    results = list(executor.map(fetch, urls))

# –†–µ–∑—É–ª—å—Ç–∞—Ç: ~50/50 –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –º–µ–∂–¥—É –º–æ–¥–µ–º–∞–º–∏
```

### Instagram API

```python
import requests

def get_user_info(username):
    url = f"https://www.instagram.com/{username}/?__a=1"
    response = requests.get(url, proxies=proxies)
    return response.json()

users = ["user1", "user2", "user3", ...]

# –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –º–æ–∂–µ—Ç –ø–æ–π—Ç–∏ —á–µ—Ä–µ–∑ —Ä–∞–∑–Ω—ã–π –º–æ–¥–µ–º
for user in users:
    info = get_user_info(user)
    # Process...
```

## –í—ã–≤–æ–¥—ã

1. **–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ** - L4 hash + multipath routing
2. **Connection pooling - —ç—Ç–æ —Ö–æ—Ä–æ—à–æ** - –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ –≤–∏–¥–∏–º–æ–π –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ** - —Ä–∞–∑–Ω—ã–µ —Ö–æ—Å—Ç—ã –∏–ª–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
4. **–í —Ä–µ–∞–ª—å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –æ—Ç–ª–∏—á–Ω–∞—è** - –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ö–æ—Å—Ç–æ–≤ –∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

**–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –∑–∞–¥—É–º–∞–Ω–æ! üéâ**
